version: '3.7'
services:
  http-proxy:
    environment:
      BOOTSTRAP_PATH: '/run/secrets/elastic-bootstrap-password'
  web-app:
    environment:
      DB_HOST: mariadb
      BOOTSTRAP_PATH: "/run/secrets/elastic-bootstrap-password"
      MYSQL_USER_PATH: "/run/secrets/mysql_webapp_user"
      MYSQL_PASSWORD_PATH: "/run/secrets/mysql_webapp_password"
      NEO4J_USER_PATH: "/run/secrets/webapp_neo4j_user"
      NEO4J_PASSWORD_PATH: "/run/secrets/webapp_neo4j_password"
  logstash:
    environment:
      MARIADB_HOST: mariadb
      XPACK_MONITORING_ELASTICSEARCH_SSL_CERTIFICATEAUTHORITY: /run/secrets/elastic-ca
  gtas-scheduler:
    environment:
      DB_HOST: mariadb
      MYSQL_USER_PATH: "/run/secrets/mysql_processor_user"
      MYSQL_PASSWORD_PATH: "/run/secrets/mysql_processor_password"
      NEO4J_USER_PATH: "/run/secrets/webapp_neo4j_user"
      NEO4J_PASSWORD_PATH: "/run/secrets/webapp_neo4j_password"
  etl-job:
    environment:
      DB_HOSTNAME: mariadb
      NEO4J_USER_PATH: '/run/secrets/etl-neo4j-user'
      NEO4J_PASSWORD_PATH: '/run/secrets/etl-neo4j-password'
      MYSQL_USER_PATH: '/run/secrets/mysql-etl-user'
      MYSQL_PASSWORD_PATH: '/run/secrets/mysql-etl-password'
  elk-setup:
    environment:
      LOGSTASH_PASSWORD_PATH: '/run/secrets/logstash-keystore-password' 
      MYSQL_USER_PATH: '/run/secrets/mysql-logstash-user'
      MYSQL_PASSWORD_PATH: '/run/secrets/mysql-logstash-password'
      KIBANA_PASSWORD_PATH: '/run/secrets/elasticsearch-kibana-password'
      BOOTSTRAP_PATH: '/run/secrets/elastic-bootstrap-password'
      ELASTIC_PATH: '/run/secrets/elastic-password'